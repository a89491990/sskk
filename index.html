<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>üöÄ Airdrop Project Manager Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #7c3aed 50%, #ec4899 100%);
      min-height: 100vh;
    }
    .glass {
      background: rgba(15, 23, 42, 0.45);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }
    .scrollbar-thin::-webkit-scrollbar {
      height: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, .6);
      border-radius: 999px;
    }
  </style>
</head>
<body class="text-white font-sans">
  <div class="max-w-6xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
      <div>
        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight drop-shadow">
          üöÄ Airdrop Project Manager
        </h1>
        <p class="text-slate-100/80 mt-1">
          Firebase + Multi Photo + Search + Reminder
        </p>
      </div>
      <button
        class="px-5 py-3 rounded-2xl bg-indigo-500 hover:bg-indigo-600 font-semibold shadow-lg shadow-indigo-500/40 flex items-center gap-2"
        onclick="openModal()"
      >
        <span class="text-xl">Ôºã</span> ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü
      </button>
    </div>

    <!-- Search + Filter -->
    <div class="glass rounded-2xl px-4 py-3 mb-6 flex flex-col md:flex-row gap-3 items-start md:items-center">
      <div class="flex-1 w-full">
        <label class="block text-xs uppercase tracking-wide text-slate-200/70 mb-1">Search</label>
        <div class="relative">
          <input
            id="searchInput"
            type="text"
            placeholder="‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ / ‡¶®‡ßã‡¶ü ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®‚Ä¶"
            class="w-full pl-9 pr-3 py-2 rounded-xl bg-slate-900/40 border border-slate-500/60 text-sm outline-none focus:ring-2 focus:ring-pink-500"
          />
          <span class="absolute inset-y-0 left-2 flex items-center text-slate-300">
            üîç
          </span>
        </div>
      </div>
      <div>
        <label class="block text-xs uppercase tracking-wide text-slate-200/70 mb-1">Reminder Filter</label>
        <select
          id="filterSelect"
          class="px-3 py-2 rounded-xl bg-slate-900/40 border border-slate-500/60 text-sm outline-none focus:ring-2 focus:ring-pink-500"
        >
          <option value="all">All</option>
          <option value="daily">Daily Only</option>
          <option value="weekly">Weekly Only</option>
        </select>
      </div>
    </div>

    <!-- Projects Grid -->
    <div id="projectsGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5"></div>
    <div id="emptyState" class="hidden text-center text-lg mt-10 text-slate-100/80">
      üìã ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶®‡ßá‡¶á ‚Äì ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
    </div>
  </div>

  <!-- Modal -->
  <div
    id="projectModal"
    class="fixed inset-0 hidden items-center justify-center bg-black/60 z-50"
  >
    <div class="glass rounded-3xl p-6 w-11/12 max-w-xl max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-4">
        <h2 id="modalTitle" class="text-2xl font-bold">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü</h2>
        <button
          class="w-9 h-9 rounded-full bg-slate-900/70 hover:bg-slate-800 flex items-center justify-center"
          type="button"
          onclick="closeModal()"
        >
          ‚úï
        </button>
      </div>

      <form id="projectForm" onsubmit="saveProject(event)" class="space-y-4">
        <input type="hidden" id="projectId" />

        <div>
          <label class="block text-sm mb-1">‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ *</label>
          <input
            id="projectName"
            required
            class="w-full px-3 py-2 rounded-xl bg-slate-900/50 border border-slate-500/70 text-sm outline-none focus:ring-2 focus:ring-pink-500"
          />
        </div>

        <div>
          <label class="block text-sm mb-1">‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï</label>
          <input
            id="projectLink"
            type="url"
            placeholder="https://example.com"
            class="w-full px-3 py-2 rounded-xl bg-slate-900/50 border border-slate-500/70 text-sm outline-none focus:ring-2 focus:ring-pink-500"
          />
        </div>

        <div>
          <label class="block text-sm mb-1">‡¶®‡ßã‡¶ü</label>
          <textarea
            id="projectNotes"
            rows="3"
            class="w-full px-3 py-2 rounded-xl bg-slate-900/50 border border-slate-500/70 text-sm outline-none focus:ring-2 focus:ring-pink-500"
          ></textarea>
        </div>

        <div>
          <label class="block text-sm mb-1">‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞</label>
          <select
            id="reminderType"
            class="w-full px-3 py-2 rounded-xl bg-slate-900/50 border border-slate-500/70 text-sm outline-none focus:ring-2 focus:ring-pink-500"
          >
            <option value="none">‡¶∞‡¶ø‡¶Æ‡¶æ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶æ‡¶á</option>
            <option value="daily">‡¶°‡ßá‡¶á‡¶≤‡¶ø</option>
            <option value="weekly">‡¶â‡¶á‡¶ï‡¶≤‡¶ø</option>
          </select>
        </div>

        <!-- Logo upload -->
        <div>
          <label class="block text-sm mb-1">‡¶≤‡ßã‡¶ó‡ßã (‡¶è‡¶ï‡¶ü‡¶æ ‡¶õ‡¶¨‡¶ø)</label>
          <input
            id="logoInput"
            type="file"
            accept="image/*"
            class="text-sm"
          />
          <div class="mt-2">
            <img
              id="logoPreview"
              class="hidden w-20 h-20 rounded-xl object-cover border border-slate-500/70"
            />
          </div>
        </div>

        <!-- Multiple photos -->
        <div>
          <label class="block text-sm mb-1">‡¶´‡¶ü‡ßã (‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®)</label>
          <input
            id="photosInput"
            type="file"
            accept="image/*"
            multiple
            class="text-sm"
          />
          <div
            id="photosPreview"
            class="mt-2 grid grid-cols-4 gap-2 max-h-32 overflow-x-auto scrollbar-thin"
          ></div>
        </div>

        <div class="flex justify-end gap-3 pt-2">
          <button
            type="button"
            class="px-4 py-2 rounded-xl bg-slate-600/70 hover:bg-slate-700 text-sm"
            onclick="closeModal()"
          >
            ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤
          </button>
          <button
            id="saveBtn"
            type="submit"
            class="px-4 py-2 rounded-xl bg-pink-500 hover:bg-pink-600 text-sm font-semibold flex items-center gap-2"
          >
            <span id="saveBtnText">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</span>
            <span
              id="saveBtnSpinner"
              class="hidden w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"
            ></span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Firebase + App Logic -->
  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
    import {
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      query,
      orderBy,
      deleteDoc,
      doc,
      serverTimestamp,
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
    import {
      getStorage,
      ref,
      uploadBytes,
      getDownloadURL,
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

    // üî• Your Firebase config (‡¶§‡ßã‡¶Æ‡¶æ‡¶∞‡¶ü‡¶æ‡¶á ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶õ‡¶ø)
    const firebaseConfig = {
      apiKey: "AIzaSyAZNDCJ4VIR3j_Ex4R-lIcCnDDEbV12lfk",
      authDomain: "backup-4a8c9.firebaseapp.com",
      projectId: "backup-4a8c9",
      storageBucket: "backup-4a8c9.firebasestorage.app",
      messagingSenderId: "244182636630",
      appId: "1:244182636630:web:4cba2de413bdccfb7dc3f7",
      measurementId: "G-M3WF7DGLNZ",
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    getAnalytics(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // ---------- State ----------
    let projects = [];
    let searchTerm = "";
    let filterType = "all";

    // Reminder last shown times (localStorage)
    const REMINDER_KEY = "airdrop_reminders";
    function loadReminderState() {
      try {
        return JSON.parse(localStorage.getItem(REMINDER_KEY)) || {};
      } catch {
        return {};
      }
    }
    function saveReminderState(state) {
      localStorage.setItem(REMINDER_KEY, JSON.stringify(state));
    }
    let reminderState = loadReminderState();

    // ---------- Realtime listener ----------
    const qRef = query(
      collection(db, "projects"),
      orderBy("createdAt", "desc")
    );

    onSnapshot(qRef, (snapshot) => {
      projects = snapshot.docs.map((d) => ({ id: d.id, ...d.data() }));
      applyFiltersAndRender();
    });

    // ---------- Helpers ----------
    function applyFiltersAndRender() {
      let list = [...projects];

      // search
      if (searchTerm.trim()) {
        const s = searchTerm.toLowerCase();
        list = list.filter(
          (p) =>
            (p.name || "").toLowerCase().includes(s) ||
            (p.notes || "").toLowerCase().includes(s)
        );
      }

      // filter by reminder
      if (filterType !== "all") {
        list = list.filter((p) => p.reminder === filterType);
      }

      renderProjects(list);
    }

    function renderProjects(list) {
      const grid = document.getElementById("projectsGrid");
      const empty = document.getElementById("emptyState");
      grid.innerHTML = "";

      if (!list.length) {
        empty.classList.remove("hidden");
        return;
      }
      empty.classList.add("hidden");

      list.forEach((p) => {
        const card = document.createElement("div");
        card.className =
          "glass rounded-2xl p-5 flex flex-col gap-3 shadow-lg shadow-slate-900/40";

        const logoBlock = p.logo
          ? `<img src="${p.logo}" class="w-12 h-12 rounded-xl object-cover" />`
          : `<div class="w-12 h-12 rounded-xl bg-indigo-500 flex items-center justify-center">üöÄ</div>`;

        const photosHtml =
          p.photos && p.photos.length
            ? `<div class="grid grid-cols-3 gap-1 mt-2">
                ${p.photos
                  .map(
                    (url) =>
                      `<img src="${url}" class="w-full h-16 object-cover rounded-md" />`
                  )
                  .join("")}
              </div>`
            : "";

        const reminderBadge =
          p.reminder && p.reminder !== "none"
            ? `<span class="inline-flex items-center px-2 py-1 rounded-full text-[11px] bg-emerald-500/80">
                üîî ${p.reminder === "daily" ? "Daily" : "Weekly"}
              </span>`
            : "";

        card.innerHTML = `
          <div class="flex items-center gap-3">
            ${logoBlock}
            <div class="flex-1">
              <div class="font-semibold text-base">${p.name || ""}</div>
              <div class="text-xs text-slate-200/80 mt-1 flex items-center gap-2">
                ${reminderBadge}
                <span class="opacity-70">${
                  p.createdAt?.toDate
                    ? p.createdAt.toDate().toLocaleString()
                    : ""
                }</span>
              </div>
            </div>
          </div>

          ${
            p.link
              ? `<a href="${p.link}" target="_blank" class="text-xs text-sky-300 underline break-all">üîó ${p.link}</a>`
              : ""
          }

          ${
            p.notes
              ? `<p class="text-sm text-slate-100/90">${p.notes}</p>`
              : ""
          }

          ${photosHtml}

          <div class="flex justify-end mt-2">
            <button
              class="px-3 py-1 rounded-lg bg-red-500 hover:bg-red-600 text-xs"
              onclick="deleteProject('${p.id}')"
            >
              üóëÔ∏è ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü
            </button>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    // ---------- File preview ----------
    const logoInput = document.getElementById("logoInput");
    const logoPreview = document.getElementById("logoPreview");
    const photosInput = document.getElementById("photosInput");
    const photosPreview = document.getElementById("photosPreview");

    logoInput.addEventListener("change", () => {
      const file = logoInput.files[0];
      if (!file) {
        logoPreview.classList.add("hidden");
        return;
      }
      const reader = new FileReader();
      reader.onload = (e) => {
        logoPreview.src = e.target.result;
        logoPreview.classList.remove("hidden");
      };
      reader.readAsDataURL(file);
    });

    photosInput.addEventListener("change", () => {
      photosPreview.innerHTML = "";
      const files = Array.from(photosInput.files);
      if (!files.length) return;
      files.forEach((file) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = document.createElement("img");
          img.src = e.target.result;
          img.className =
            "w-full h-16 object-cover rounded-lg border border-slate-600/60";
          photosPreview.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });

    // ---------- Upload helper ----------
    async function uploadImage(file, folder) {
      const fileRef = ref(
        storage,
        `${folder}/${Date.now()}-${Math.random().toString(36).slice(2)}-${
          file.name
        }`
      );
      await uploadBytes(fileRef, file);
      return await getDownloadURL(fileRef);
    }

    // ---------- Save project ----------
    async function saveProject(e) {
      e.preventDefault();
      const saveBtn = document.getElementById("saveBtn");
      const saveText = document.getElementById("saveBtnText");
      const saveSpinner = document.getElementById("saveBtnSpinner");

      saveBtn.disabled = true;
      saveText.textContent = "Saving...";
      saveSpinner.classList.remove("hidden");

      const name = document.getElementById("projectName").value.trim();
      const link = document.getElementById("projectLink").value.trim();
      const notes = document.getElementById("projectNotes").value.trim();
      const reminder = document.getElementById("reminderType").value;

      const logoFile = logoInput.files[0];
      const photoFiles = Array.from(photosInput.files);

      let logoUrl = null;
      if (logoFile) {
        logoUrl = await uploadImage(logoFile, "logos");
      }

      const photoUrls = [];
      for (const f of photoFiles) {
        const url = await uploadImage(f, "photos");
        photoUrls.push(url);
      }

      await addDoc(collection(db, "projects"), {
        name,
        link,
        notes,
        reminder,
        logo: logoUrl,
        photos: photoUrls,
        createdAt: serverTimestamp(),
      });

      saveBtn.disabled = false;
      saveText.textContent = "‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®";
      saveSpinner.classList.add("hidden");

      closeModal();
      document.getElementById("projectForm").reset();
      logoPreview.classList.add("hidden");
      photosPreview.innerHTML = "";
    }

    // ---------- Delete ----------
    async function deleteProject(id) {
      if (confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
        await deleteDoc(doc(db, "projects", id));
      }
    }

    // ---------- Modal ----------
    function openModal() {
      document.getElementById("projectModal").classList.remove("hidden");
      document.getElementById("projectModal").classList.add("flex");
    }
    function closeModal() {
      document.getElementById("projectModal").classList.add("hidden");
      document.getElementById("projectModal").classList.remove("flex");
    }

    // search + filter events
    document.getElementById("searchInput").addEventListener("input", (e) => {
      searchTerm = e.target.value;
      applyFiltersAndRender();
    });
    document.getElementById("filterSelect").addEventListener("change", (e) => {
      filterType = e.target.value;
      applyFiltersAndRender();
    });

    // ---------- Reminder checker ----------
    function checkReminders() {
      const now = new Date();
      const todayStr = now.toDateString();

      projects.forEach((p) => {
        if (!p.reminder || p.reminder === "none") return;

        const last = reminderState[p.id];
        if (p.reminder === "daily") {
          if (last === todayStr) return;
          // show
          alert(`üîî Daily Reminder: ${p.name}\n‡¶è‡¶á ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá ‡¶Ü‡¶ú ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶® ‡¶§‡ßã?`);
          reminderState[p.id] = todayStr;
        } else if (p.reminder === "weekly") {
          const lastDate = last ? new Date(last) : null;
          if (lastDate) {
            const diff =
              (now.getTime() - lastDate.getTime()) / (1000 * 60 * 60 * 24);
            if (diff < 7) return;
          }
          alert(
            `üîî Weekly Reminder: ${p.name}\n‡¶è‡¶á ‡¶∏‡¶™‡ßç‡¶§‡¶æ‡¶π‡ßá ‡¶è‡¶á ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`
          );
          reminderState[p.id] = now.toISOString();
        }
      });

      saveReminderState(reminderState);
    }

    // run reminder check ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ßß ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡ßü ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞
    setInterval(checkReminders, 60 * 60 * 1000);
    // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶°‡ßá‡¶∞ ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ï‡ßç‡¶∑‡¶£ ‡¶™‡¶∞ ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞
    setTimeout(checkReminders, 10 * 1000);

    // expose for inline handlers
    window.openModal = openModal;
    window.closeModal = closeModal;
    window.deleteProject = deleteProject;
  </script>
</body>
</html>
